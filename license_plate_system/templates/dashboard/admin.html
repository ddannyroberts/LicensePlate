{% extends 'base.html' %}
{% load static %}

{% block title %}Admin Dashboard - LicenseGuard AI{% endblock %}

{% block extra_css %}
<style>
    .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem;
        margin-bottom: 2rem;
    }

    .dashboard-card {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 20px;
        padding: 2rem;
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
        transition: all 0.3s ease;
    }

    .dashboard-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 35px 70px rgba(0, 0, 0, 0.4);
    }

    .card-header {
        display: flex;
        justify-content: between;
        align-items: center;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .card-title {
        color: #fff;
        font-size: 1.2rem;
        font-weight: 600;
        margin: 0;
    }

    .card-icon {
        font-size: 1.5rem;
        color: #3498db;
        margin-right: 1rem;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
        margin-bottom: 2rem;
    }

    .stat-item {
        background: rgba(255, 255, 255, 0.05);
        padding: 1.5rem;
        border-radius: 15px;
        text-align: center;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .stat-number {
        font-size: 2.5rem;
        font-weight: bold;
        color: #3498db;
        margin-bottom: 0.5rem;
    }

    .stat-label {
        color: rgba(255, 255, 255, 0.7);
        font-size: 0.9rem;
    }

    .activity-item {
        display: flex;
        align-items: center;
        padding: 1rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
    }

    .activity-item:hover {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 10px;
        border-bottom-color: transparent;
    }

    .activity-item:last-child {
        border-bottom: none;
    }

    .activity-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 1rem;
        font-size: 1rem;
    }

    .activity-icon.success {
        background: rgba(46, 204, 113, 0.2);
        color: #2ecc71;
    }

    .activity-icon.danger {
        background: rgba(231, 76, 60, 0.2);
        color: #e74c3c;
    }

    .activity-icon.warning {
        background: rgba(243, 156, 18, 0.2);
        color: #f39c12;
    }

    .activity-info {
        flex: 1;
    }

    .activity-title {
        color: #fff;
        font-weight: 500;
        margin-bottom: 0.25rem;
    }

    .activity-subtitle {
        color: rgba(255, 255, 255, 0.6);
        font-size: 0.85rem;
    }

    .activity-time {
        color: rgba(255, 255, 255, 0.5);
        font-size: 0.8rem;
    }

    .control-panel {
        background: linear-gradient(135deg, rgba(52, 152, 219, 0.2), rgba(46, 204, 113, 0.2));
        border-radius: 20px;
        padding: 2rem;
        margin-bottom: 2rem;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .control-buttons {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
    }

    .control-btn {
        background: linear-gradient(45deg, #3498db, #2ecc71);
        border: none;
        color: white;
        padding: 12px 24px;
        border-radius: 25px;
        font-weight: 600;
        transition: all 0.3s ease;
        box-shadow: 0 10px 25px rgba(52, 152, 219, 0.3);
        cursor: pointer;
    }

    .control-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 15px 35px rgba(52, 152, 219, 0.4);
    }

    .control-btn.danger {
        background: linear-gradient(45deg, #e74c3c, #c0392b);
        box-shadow: 0 10px 25px rgba(231, 76, 60, 0.3);
    }

    .control-btn.danger:hover {
        box-shadow: 0 15px 35px rgba(231, 76, 60, 0.4);
    }

    .gate-status {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 1rem;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 10px;
        margin-bottom: 1rem;
    }

    .status-indicator {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 0.5rem;
        animation: pulse 2s infinite;
    }

    .status-closed {
        background: #e74c3c;
    }

    .status-open {
        background: #2ecc71;
    }

    @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.5; }
        100% { opacity: 1; }
    }

    .chart-container {
        height: 300px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: rgba(255, 255, 255, 0.5);
        font-style: italic;
    }

    .top-vehicles-list {
        max-height: 300px;
        overflow-y: auto;
    }

    .vehicle-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .vehicle-item:last-child {
        border-bottom: none;
    }

    .vehicle-plate {
        font-family: 'Courier New', monospace;
        font-weight: bold;
        color: #3498db;
    }

    .vehicle-count {
        background: rgba(46, 204, 113, 0.2);
        color: #2ecc71;
        padding: 0.25rem 0.75rem;
        border-radius: 15px;
        font-size: 0.85rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <h1 class="text-center mb-4">
                <i class="fas fa-tachometer-alt text-primary me-3"></i>
                Admin Dashboard
            </h1>
            <p class="text-center text-muted mb-5">Complete system overview and control center</p>
        </div>
    </div>

    <!-- Statistics Grid -->
    <div class="stats-grid">
        <div class="stat-item">
            <div class="stat-number">{{ stats.total_registered_plates|default:0 }}</div>
            <div class="stat-label">Registered Plates</div>
        </div>
        <div class="stat-item">
            <div class="stat-number">{{ stats.total_videos|default:0 }}</div>
            <div class="stat-label">Videos Processed</div>
        </div>
        <div class="stat-item">
            <div class="stat-number">{{ stats.total_known_detections|default:0 }}</div>
            <div class="stat-label">Known Detections</div>
        </div>
        <div class="stat-item">
            <div class="stat-number">{{ stats.total_unknown_detections|default:0 }}</div>
            <div class="stat-label">Unknown Detections</div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="control-panel">
        <h4 class="text-white mb-3">
            <i class="fas fa-bolt me-2"></i>
            Quick Actions
        </h4>
        <div class="control-buttons">
            <a href="{% url 'vehicle_control:admin_upload_video' %}" class="control-btn">
                <i class="fas fa-video me-2"></i>Upload Video
            </a>
            <a href="{% url 'vehicle_control:admin_plate_history' %}" class="control-btn">
                <i class="fas fa-history me-2"></i>Plate History
            </a>
            <a href="{% url 'vehicle_control:admin_video_list' %}" class="control-btn">
                <i class="fas fa-list me-2"></i>Video List
            </a>
            <a href="{% url 'admin:index' %}" class="control-btn">
                <i class="fas fa-cog me-2"></i>Admin Panel
            </a>
        </div>
    </div>

    <!-- Dashboard Grid -->
    <div class="dashboard-grid">
        <!-- Recent Known Plates -->
        <div class="dashboard-card">
            <div class="card-header">
                <h5 class="card-title">
                    <i class="fas fa-check-circle card-icon"></i>
                    Recent Known Detections
                </h5>
                <a href="{% url 'vehicle_control:admin_plate_history' %}" class="btn btn-sm btn-outline-primary">
                    View All
                </a>
            </div>
            <div class="row g-3 p-3">
                {% for known in recent_known|slice:":6" %}
                <div class="col-md-6 col-lg-4">
                    <div class="glass-card p-3" style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px;">
                        <div class="text-center mb-2">
                            <small class="text-white-50" style="font-size: 0.75rem;">
                                <i class="fas fa-check-double text-success me-1"></i>Match Found
                            </small>
                        </div>
                        
                        <!-- Comparison Images -->
                        <div class="row g-2 mb-2">
                            <!-- Detected Image -->
                            <div class="col-6">
                                <div class="text-center mb-1">
                                    <small class="text-white-50" style="font-size: 0.65rem;">Detected</small>
                                </div>
                                {% if known.detection_image %}
                                <div style="position: relative; border-radius: 8px; overflow: hidden; border: 2px solid rgba(79, 172, 254, 0.5);">
                                    <img src="{{ known.detection_image.url }}" 
                                         alt="Detected: {{ known.detected_plate_number }}"
                                         class="img-fluid"
                                         style="max-height: 80px; width: 100%; object-fit: cover;">
                                    <div style="position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(to top, rgba(0,0,0,0.8), transparent); padding: 0.2rem; text-align: center;">
                                        <span class="badge bg-info" style="font-size: 0.6rem;">{{ known.detected_plate_number }}</span>
                                    </div>
                                </div>
                                {% else %}
                                <div style="background: rgba(255,255,255,0.05); border: 2px dashed rgba(255,255,255,0.2); border-radius: 8px; padding: 1rem 0.5rem; text-align: center; min-height: 80px; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                                    <i class="fas fa-image fa-2x text-muted mb-1"></i>
                                    <p class="text-muted small mb-0" style="font-size: 0.6rem;">{{ known.detected_plate_number }}</p>
                                </div>
                                {% endif %}
                            </div>
                            
                            <!-- VS Icon -->
                            <div class="col-12 text-center my-1">
                                <i class="fas fa-arrows-alt-h text-primary" style="font-size: 1rem;"></i>
                            </div>
                            
                            <!-- Registered Image -->
                            <div class="col-6">
                                <div class="text-center mb-1">
                                    <small class="text-white-50" style="font-size: 0.65rem;">In Database</small>
                                </div>
                                {% if known.registered_plate.plate_image %}
                                <div style="position: relative; border-radius: 8px; overflow: hidden; border: 2px solid rgba(132, 250, 176, 0.5);">
                                    <img src="{{ known.registered_plate.plate_image.url }}" 
                                         alt="Registered: {{ known.registered_plate.plate_number }}"
                                         class="img-fluid"
                                         style="max-height: 80px; width: 100%; object-fit: cover;">
                                    <div style="position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(to top, rgba(0,0,0,0.8), transparent); padding: 0.2rem; text-align: center;">
                                        <span class="badge bg-success" style="font-size: 0.6rem;">{{ known.registered_plate.plate_number }}</span>
                                    </div>
                                </div>
                                {% else %}
                                <div style="background: rgba(255,255,255,0.05); border: 2px dashed rgba(255,255,255,0.2); border-radius: 8px; padding: 1rem 0.5rem; text-align: center; min-height: 80px; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                                    <i class="fas fa-image fa-2x text-muted mb-1"></i>
                                    <p class="text-muted small mb-0" style="font-size: 0.6rem;">{{ known.registered_plate.plate_number }}</p>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <!-- Details -->
                        <div style="background: rgba(255,255,255,0.03); border-radius: 8px; padding: 0.5rem; margin-bottom: 0.5rem;">
                            <div style="font-size: 0.75rem;">
                                <i class="fas fa-user text-primary me-1" style="font-size: 0.7rem;"></i>
                                <strong class="text-white" style="font-size: 0.7rem;">{{ known.registered_plate.owner_name|default:"Unknown" }}</strong>
                            </div>
                            <div style="font-size: 0.7rem; color: rgba(255,255,255,0.6);">
                                <i class="fas fa-clock me-1"></i>{{ known.detected_at|timesince }} ago
                            </div>
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="col-12">
                    <div class="text-center py-4">
                        <i class="fas fa-check-circle fa-3x text-muted mb-3"></i>
                        <p class="text-muted">No known detections yet</p>
                        <a href="{% url 'vehicle_control:admin_upload_video' %}" class="btn btn-sm btn-outline-primary">
                            Upload Video to Start
                        </a>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Recent Videos -->
        <div class="dashboard-card">
            <div class="card-header">
                <h5 class="card-title">
                    <i class="fas fa-video card-icon"></i>
                    Recent Videos
                </h5>
                <a href="{% url 'vehicle_control:admin_upload_video' %}" class="btn btn-sm btn-outline-success">
                    Upload Video
                </a>
            </div>
            <div class="activity-list">
                {% for video in recent_videos|slice:":5" %}
                <div class="activity-item">
                    <div class="activity-icon {% if video.status == 'completed' %}success{% elif video.status == 'error' %}danger{% else %}warning{% endif %}">
                        <i class="fas fa-video"></i>
                    </div>
                    <div class="activity-info">
                        <div class="activity-title">
                            <a href="{% url 'vehicle_control:admin_video_detail' video.id %}" class="text-white text-decoration-none">
                                Video #{{ video.id }}
                            </a>
                        </div>
                        <div class="activity-subtitle">{{ video.get_status_display|default:"Processing" }}</div>
                    </div>
                    <div class="activity-time">{{ video.upload_timestamp|timesince }}</div>
                </div>
                {% empty %}
                <div class="activity-item">
                    <div class="activity-icon warning">
                        <i class="fas fa-video"></i>
                    </div>
                    <div class="activity-info">
                        <div class="activity-title">No videos uploaded yet</div>
                        <div class="activity-subtitle">Upload a video to start processing</div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Recent Unknown Plates -->
        <div class="dashboard-card">
            <div class="card-header">
                <h5 class="card-title">
                    <i class="fas fa-question-circle card-icon"></i>
                    Recent Unknown Detections
                </h5>
                <a href="{% url 'vehicle_control:admin_plate_history' %}" class="btn btn-sm btn-outline-warning">
                    View All
                </a>
            </div>
            <div class="activity-list">
                {% for unknown in recent_unknown|slice:":5" %}
                <div class="activity-item">
                    <div class="activity-icon warning">
                        <i class="fas fa-question"></i>
                    </div>
                    <div class="activity-info">
                        <div class="activity-title">{{ unknown.detected_plate_number|default:"XYZ-9876" }}</div>
                        <div class="activity-subtitle">Not in database</div>
                    </div>
                    <div class="activity-time">{{ unknown.detected_at|timesince }}</div>
                </div>
                {% empty %}
                <div class="activity-item">
                    <div class="activity-icon warning">
                        <i class="fas fa-question"></i>
                    </div>
                    <div class="activity-info">
                        <div class="activity-title">No unknown detections yet</div>
                        <div class="activity-subtitle">All detected plates are registered</div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Top Registered Plates -->
        <div class="dashboard-card">
            <div class="card-header">
                <h5 class="card-title">
                    <i class="fas fa-trophy card-icon"></i>
                    Top Registered Plates
                </h5>
                <a href="{% url 'admin:vehicle_control_registeredlicenseplate_changelist' %}" class="btn btn-sm btn-outline-primary">
                    Manage
                </a>
            </div>
            <div class="top-vehicles-list">
                {% for plate in top_plates|slice:":10" %}
                <div class="vehicle-item">
                    <div class="vehicle-plate">{{ plate.plate_number|default:"ABC-1234" }}</div>
                    <div class="vehicle-count">{{ plate.owner_name|default:"Owner" }}</div>
                </div>
                {% empty %}
                <div class="vehicle-item">
                    <div class="vehicle-plate">No registered plates yet</div>
                    <div class="vehicle-count">-</div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- System Statistics -->
        <div class="dashboard-card">
            <div class="card-header">
                <h5 class="card-title">
                    <i class="fas fa-chart-line card-icon"></i>
                    System Statistics
                </h5>
            </div>
            <div class="activity-list">
                <div class="activity-item">
                    <div class="activity-icon success">
                        <i class="fas fa-calendar-day"></i>
                    </div>
                    <div class="activity-info">
                        <div class="activity-title">Today's Videos</div>
                        <div class="activity-subtitle">{{ stats.today_videos|default:0 }} videos processed</div>
                    </div>
                </div>
                <div class="activity-item">
                    <div class="activity-icon success">
                        <i class="fas fa-calendar-week"></i>
                    </div>
                    <div class="activity-info">
                        <div class="activity-title">This Week</div>
                        <div class="activity-subtitle">{{ stats.week_videos|default:0 }} videos processed</div>
                    </div>
                </div>
                <div class="activity-item">
                    <div class="activity-icon success">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <div class="activity-info">
                        <div class="activity-title">This Month</div>
                        <div class="activity-subtitle">{{ stats.month_videos|default:0 }} videos processed</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Status -->
        <div class="dashboard-card">
            <div class="card-header">
                <h5 class="card-title">
                    <i class="fas fa-server card-icon"></i>
                    System Status
                </h5>
                <a href="{% url 'admin:index' %}" class="btn btn-sm btn-outline-secondary">
                    Settings
                </a>
            </div>
            <div class="activity-list">
                <div class="activity-item">
                    <div class="activity-icon success">
                        <i class="fas fa-check"></i>
                    </div>
                    <div class="activity-info">
                        <div class="activity-title">Video Processing</div>
                        <div class="activity-subtitle">Active</div>
                    </div>
                </div>
                <div class="activity-item">
                    <div class="activity-icon success">
                        <i class="fas fa-check"></i>
                    </div>
                    <div class="activity-info">
                        <div class="activity-title">License Plate Detection</div>
                        <div class="activity-subtitle">Online</div>
                    </div>
                </div>
                <div class="activity-item">
                    <div class="activity-icon success">
                        <i class="fas fa-check"></i>
                    </div>
                    <div class="activity-info">
                        <div class="activity-title">Database</div>
                        <div class="activity-subtitle">Connected</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Auto-refresh dashboard every 30 seconds
setInterval(() => {
    // In a real application, this would fetch updated data
    console.log('Refreshing dashboard data...');
}, 30000);
</script>
{% endblock %}