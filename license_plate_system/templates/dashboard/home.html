{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard - LicenseGuard AI{% endblock %}

{% block extra_css %}
<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
<style>
    /* Dashboard Specific Styles */
    .stat-card {
        text-align: center;
        padding: 2.5rem 2rem;
        border-radius: 24px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(30px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
    }

    .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: var(--primary-gradient);
        transform: scaleX(0);
        transition: transform 0.4s ease;
    }

    .stat-card:hover::before {
        transform: scaleX(1);
    }

    .stat-card:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: 0 20px 60px rgba(102, 126, 234, 0.3);
        border-color: rgba(102, 126, 234, 0.4);
    }

    .stat-card.primary { 
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.25), rgba(118, 75, 162, 0.25)); 
        border-color: rgba(102, 126, 234, 0.3);
    }
    .stat-card.success { 
        background: linear-gradient(135deg, rgba(132, 250, 176, 0.25), rgba(143, 211, 244, 0.25)); 
        border-color: rgba(132, 250, 176, 0.3);
    }
    .stat-card.info { 
        background: linear-gradient(135deg, rgba(79, 172, 254, 0.25), rgba(0, 242, 254, 0.25)); 
        border-color: rgba(79, 172, 254, 0.3);
    }
    .stat-card.warning { 
        background: linear-gradient(135deg, rgba(240, 147, 251, 0.25), rgba(245, 87, 108, 0.25)); 
        border-color: rgba(240, 147, 251, 0.3);
    }

    .stat-icon {
        font-size: 3rem;
        margin-bottom: 1rem;
        display: block;
        background: var(--primary-gradient);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        animation: iconFloat 3s ease-in-out infinite;
    }

    @keyframes iconFloat {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-10px); }
    }

    .stat-card.primary .stat-icon {
        background: linear-gradient(135deg, #667eea, #764ba2);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .stat-card.success .stat-icon {
        background: linear-gradient(135deg, #84fab0, #8fd3f4);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .stat-card.info .stat-icon {
        background: linear-gradient(135deg, #4facfe, #00f2fe);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .stat-card.warning .stat-icon {
        background: linear-gradient(135deg, #f093fb, #f5576c);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .stat-number {
        font-size: 3rem;
        font-weight: 900;
        margin-bottom: 0.5rem;
        background: linear-gradient(135deg, #ffffff, rgba(255, 255, 255, 0.8));
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .welcome-card {
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.15), rgba(118, 75, 162, 0.15));
        backdrop-filter: blur(40px);
        border: 2px solid rgba(255, 255, 255, 0.2);
        border-radius: 28px;
        padding: 3rem;
        text-align: center;
        position: relative;
        overflow: hidden;
    }

    .welcome-card::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
        animation: rotate 20s linear infinite;
    }

    @keyframes rotate {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .welcome-card h1 {
        position: relative;
        z-index: 1;
        font-size: 2.5rem;
        font-weight: 900;
        background: linear-gradient(135deg, #ffffff, rgba(255, 255, 255, 0.9));
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .action-card {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(30px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 24px;
        padding: 2.5rem;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
    }

    .action-card::after {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
        transition: left 0.6s;
    }

    .action-card:hover::after {
        left: 100%;
    }

    .action-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 25px 60px rgba(102, 126, 234, 0.3);
        border-color: rgba(102, 126, 234, 0.4);
    }

    .table-dark-custom {
        background: rgba(255, 255, 255, 0.08);
        border-radius: 20px;
        overflow: hidden;
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .table-dark-custom thead {
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.3), rgba(118, 75, 162, 0.3));
    }

    .table-dark-custom th {
        border: none;
        padding: 1.2rem 1.5rem;
        color: #ffffff;
        font-weight: 700;
        text-transform: uppercase;
        font-size: 0.85rem;
        letter-spacing: 1px;
    }

    .table-dark-custom td {
        border: none;
        padding: 1.2rem 1.5rem;
        color: rgba(255, 255, 255, 0.9);
        background: rgba(255, 255, 255, 0.02);
        transition: all 0.3s ease;
    }

    .table-dark-custom tbody tr {
        transition: all 0.3s ease;
    }

    .table-dark-custom tbody tr:hover {
        background: rgba(102, 126, 234, 0.15);
        transform: scale(1.01);
    }

    .empty-state {
        padding: 4rem 2rem;
        text-align: center;
    }

    .empty-state i {
        font-size: 5rem;
        background: var(--primary-gradient);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 1.5rem;
        display: block;
        animation: iconPulse 2s ease-in-out infinite;
    }

    @keyframes iconPulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.1); }
    }

    /* Responsive */
    @media (max-width: 768px) {
        .stat-card {
            padding: 2rem 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .stat-number {
            font-size: 2.5rem;
        }

        .stat-icon {
            font-size: 2.5rem;
        }

        .welcome-card {
            padding: 2rem 1.5rem;
        }

        .welcome-card h1 {
            font-size: 2rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Welcome Section -->
<div class="container mt-4 mb-5">
    <div class="row mb-5">
        <div class="col-12" data-aos="fade-up">
            <div class="welcome-card glass-card">
                <h1>
                    Welcome back, {{ user.first_name|default:user.username }}! ðŸ‘‹
                </h1>
                <p class="lead text-white-50 mt-3" style="position: relative; z-index: 1;">
                    {% if user.is_staff %}
                        Manage your license plate detection system and monitor all activities.
                    {% else %}
                        Register your license plates and track your vehicle information.
                    {% endif %}
                </p>
            </div>
        </div>
    </div>

    <!-- Statistics -->
    <div class="row mb-5">
        {% if user.is_staff %}
        <div class="col-lg-3 col-md-6 mb-4" data-aos="fade-up" data-aos-delay="100">
            <div class="stat-card primary">
                <i class="fas fa-car stat-icon"></i>
                <div class="stat-number">{{ stats.total_registered_plates|default:0 }}</div>
                <div class="text-white-50" style="font-weight: 500;">Registered Plates</div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-4" data-aos="fade-up" data-aos-delay="200">
            <div class="stat-card success">
                <i class="fas fa-video stat-icon"></i>
                <div class="stat-number">{{ stats.total_videos|default:0 }}</div>
                <div class="text-white-50" style="font-weight: 500;">Videos Processed</div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-4" data-aos="fade-up" data-aos-delay="300">
            <div class="stat-card info">
                <i class="fas fa-check-circle stat-icon"></i>
                <div class="stat-number">{{ stats.total_known_detections|default:0 }}</div>
                <div class="text-white-50" style="font-weight: 500;">Known Detections</div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-4" data-aos="fade-up" data-aos-delay="400">
            <div class="stat-card warning">
                <i class="fas fa-question-circle stat-icon"></i>
                <div class="stat-number">{{ stats.total_unknown_detections|default:0 }}</div>
                <div class="text-white-50" style="font-weight: 500;">Unknown Detections</div>
            </div>
        </div>
        {% else %}
        <div class="col-lg-6 col-md-6 mb-4" data-aos="fade-up" data-aos-delay="100">
            <div class="stat-card primary">
                <i class="fas fa-car stat-icon"></i>
                <div class="stat-number">{{ stats.total_plates|default:0 }}</div>
                <div class="text-white-50" style="font-weight: 500;">My Registered Plates</div>
            </div>
        </div>
        <div class="col-lg-6 col-md-6 mb-4" data-aos="fade-up" data-aos-delay="200">
            <div class="stat-card success">
                <i class="fas fa-list stat-icon"></i>
                <div class="stat-number">{{ stats.recent_plates|default:0 }}</div>
                <div class="text-white-50" style="font-weight: 500;">Recent Registrations</div>
            </div>
        </div>
        {% endif %}
    </div>

    {% if user.is_staff %}
    <!-- Admin: Video Upload Section -->
    <div class="row mb-5" id="upload-section">
        <div class="col-12" data-aos="fade-up">
            <div class="action-card glass-card">
                <h2 class="mb-3">
                    <i class="fas fa-upload me-2"></i>Upload Video for Analysis
                </h2>
                <p class="text-white-50 mb-4">Upload a video file to detect and analyze license plates.</p>
                <a href="{% url 'vehicle_control:admin_upload_video' %}" class="btn btn-3d btn-lg">
                    <i class="fas fa-cloud-upload-alt me-2"></i>Go to Video Upload
                </a>
            </div>
        </div>
    </div>

    <!-- Admin: Recent Videos -->
    <div class="row mb-5" id="history-section">
        <div class="col-12" data-aos="fade-up">
            <div class="action-card glass-card">
                <h2 class="mb-3">
                    <i class="fas fa-video me-2"></i>Recent Videos
                </h2>
                <p class="text-white-50 mb-4">View and manage uploaded videos for license plate detection.</p>
                <a href="{% url 'vehicle_control:admin_video_list' %}" class="btn btn-3d">
                    <i class="fas fa-list me-2"></i>View All Videos
                </a>
            </div>
        </div>
    </div>
    {% else %}
    <!-- User: Register Plate Section -->
    <div class="row mb-5" id="register-section">
        <div class="col-12" data-aos="fade-up">
            <div class="action-card glass-card">
                <h2 class="mb-3">
                    <i class="fas fa-car me-2"></i>Register Your License Plate
                </h2>
                <p class="text-white-50 mb-4">Register your license plate information to help the system recognize your vehicle.</p>
                <a href="{% url 'vehicle_control:register_plate' %}" class="btn btn-3d btn-lg">
                    <i class="fas fa-plus-circle me-2"></i>Register New Plate
                </a>
            </div>
        </div>
    </div>

    <!-- User: My Registered Plates -->
    <div class="row mb-5" id="history-section">
        <div class="col-12" data-aos="fade-up">
            <div class="glass-card p-4">
                <h2 class="mb-4">
                    <i class="fas fa-list me-2"></i>My Registered Plates
                </h2>

                {% if recent_plates %}
                <div class="table-responsive">
                    <table class="table table-dark-custom">
                        <thead>
                            <tr>
                                <th>Plate Number</th>
                                <th>Owner Name</th>
                                <th>Vehicle Type</th>
                                <th>Registered Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for plate in recent_plates %}
                            <tr>
                                <td>
                                    <span class="badge" style="background: var(--primary-gradient); font-size: 0.9rem; padding: 0.5rem 1rem;">
                                        {{ plate.plate_number }}
                                    </span>
                                </td>
                                <td>{{ plate.owner_name }}</td>
                                <td>{{ plate.get_vehicle_type_display|default:"Unknown" }}</td>
                                <td>{{ plate.registered_date|date:"M d, Y" }}</td>
                                <td>
                                    <a href="{% url 'vehicle_control:my_plates' %}" class="btn btn-sm btn-outline-light">
                                        <i class="fas fa-eye me-1"></i>View
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="text-center mt-4">
                    <a href="{% url 'vehicle_control:my_plates' %}" class="btn btn-3d">
                        <i class="fas fa-list me-2"></i>View All My Plates
                    </a>
                </div>
                {% else %}
                <div class="empty-state">
                    <i class="fas fa-car"></i>
                    <h3 class="text-white mb-3">No Registered Plates</h3>
                    <p class="text-white-50 mb-4">Register your first license plate to get started!</p>
                    <a href="{% url 'vehicle_control:register_plate' %}" class="btn btn-3d btn-lg">
                        <i class="fas fa-plus-circle me-2"></i>Register Your First Plate
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script>
    // Initialize AOS
    AOS.init({
        duration: 800,
        once: true,
        offset: 100
    });
</script>
{% endblock %}
